<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Floppy Bird</title>
      <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <meta name="author" content="Nebez Briefkani" />
      <meta name="description" content="play floppy bird. a remake of popular game flappy bird built in html/css/js" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

      <link href="css/reset.css" rel="stylesheet">
      <link href="css/main.css" rel="stylesheet">
   </head>
   <body>
      <div id="gamecontainer">
         <div id="gamescreen">
            <div id="sky" class="animated">
               <div id="flyarea">
                  <div id="ceiling" class="animated"></div>
                  <div id="player" class="bird animated"></div>
                  <div id="bigscore"></div>
                  <div id="splash"></div>
                  <div id="scoreboard">
                     <div id="medal"></div>
                     <div id="currentscore"></div>
                     <div id="highscore"></div>
                     <div id="replay"><img src="assets/replay.png" alt="replay"></div>
                  </div>
               </div>
            </div>
            <div id="land" class="animated"><div id="debug"></div></div>
         </div>
      </div>
      
      <div id="footer">
         <a href="https://www.dotgears.com/">original game by dong nguyen</a>
         <a href="https://github.com/nebez/floppybird/">view github project</a>
      </div>

      <script src="js/jquery.min.js"></script>
      <script src="js/jquery.transit.min.js"></script>
      <script src="js/buzz.min.js"></script>
      <script src="js/main.js"></script>

      <script>
      // --- TELEGRAM INTEGRATION ---
      
      // 1. Get User Info from URL parameters
      const urlParams = new URLSearchParams(window.getQueryString());
      const userId = urlParams.get('user_id');
      const userName = urlParams.get('name') || "Anonymous";

      // 2. Overwrite the game's "Game Over" logic to send scores
      // We wrap this in a function to ensure main.js has loaded
      $(document).ready(function() {
          const originalSetScoreboard = window.setScoreboard;
          
          window.setScoreboard = function() {
              // Call the original game function to show the UI
              originalSetScoreboard();
              
              // Get the score from the game's internal variable
              const finalScore = score; 

              if (userId) {
                  // Send score to PythonAnywhere
                  $.ajax({
                      type: "POST",
                      url: "https://nathanw93.pythonanywhere.com/api/submit_score",
                      data: JSON.stringify({
                          user_id: userId,
                          name: userName,
                          score: finalScore
                      }),
                      contentType: "application/json; charset=utf-8",
                      dataType: "json",
                      success: function(data) {
                          console.log("Score submitted successfully!");
                      },
                      error: function(err) {
                          console.error("Failed to submit score:", err);
                      }
                  });
              }
          };
      });

      // Helper for query strings if main.js doesn't provide it
      window.getQueryString = function() {
          return window.location.search;
      };
      </script>
   </body>
</html>
